(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
"use strict";var jwt=require("frau-jwt/framed");Polymer({is:"d2l-ajax-framed",properties:{auto:Boolean,url:{type:Object,value:null},params:{type:Object,value:function(){return{}}},method:{type:String,value:"GET"},headers:{type:Object,value:function(){return{}}},contentType:String,body:{type:Object,value:null},handleAs:String,withCredentials:Boolean,timeout:Number,lastResponse:{type:Object,notify:!0},lastError:{type:Object,notify:!0},scope:{type:String,value:"*:*:*"},authToken:{type:String,value:function(){return null}},debounceDuration:{type:Number,value:0,notify:!0}},observers:["_requestOptionsChanged(url, params.*, body, auto)"],computeHeaders:function(e,t){var n,r={};if(t&&(r.Authorization="Bearer "+t),e instanceof Object)for(n in e)r[n]=e[n].toString();return r},generateRequest:function(){return jwt(this.scope).then(function(e){return this.authToken=e,this.$$("iron-ajax").generateRequest().completes}.bind(this),function(e){return this.onError(e),Promise.reject(e)}.bind(this))},onError:function(e){e.stopPropagation&&e.stopPropagation();var t=e;e&&e.detail&&(t=e.detail),this.fire("iron-ajax-error",t)},onRequest:function(e){e.stopPropagation(),this.fire("iron-ajax-request",e.detail)},onResponse:function(e){e.stopPropagation(),this.fire("iron-ajax-response",e.detail)},_requestOptionsChanged:function(){null!=this.url&&this.auto&&this.generateRequest()}});
},{"frau-jwt/framed":2}],2:[function(require,module,exports){
"use strict";var Client=require("ifrau/client"),Promise=require("lie"),REQUEST_KEY=require("./request-key");module.exports=function(e){return Promise.resolve().then(function(){var r=new Client({resizeFrame:!1,syncTitle:!1});return r.connect().then(function(){return r.request(REQUEST_KEY,e)})})};
},{"./request-key":3,"ifrau/client":5,"lie":19}],3:[function(require,module,exports){
"use strict";module.exports="frau-jwt-new-jwt";
},{}],4:[function(require,module,exports){
!function(e){"use strict";function t(e,t,n){"addEventListener"in window?e.addEventListener(t,n,!1):"attachEvent"in window&&e.attachEvent("on"+t,n)}function n(e,t,n){"removeEventListener"in window?e.removeEventListener(t,n,!1):"detachEvent"in window&&e.detachEvent("on"+t,n)}function o(e){return e.charAt(0).toUpperCase()+e.slice(1)}function i(e){return se+"["+fe+"] "+e}function r(e){le&&"object"==typeof window.console&&console.log(i(e))}function a(e){"object"==typeof window.console&&console.warn(i(e))}function u(){c(),r("Initialising iFrame ("+location.href+")"),l(),f(),d("background",K),d("padding",G),M(),v(),y(),m(),N(),b(),ae=I(),W("init","Init message from host page"),Ne()}function c(){function t(e){return"true"===e}var n=re.substr(de).split(":");fe=n[0],X=e!==n[1]?Number(n[1]):X,Q=e!==n[2]?t(n[2]):Q,le=e!==n[3]?t(n[3]):le,ue=e!==n[4]?Number(n[4]):ue,U=e!==n[6]?t(n[6]):U,Y=n[7],oe=e!==n[8]?n[8]:oe,K=n[9],G=n[10],ye=e!==n[11]?Number(n[11]):ye,ae.enable=e!==n[12]&&t(n[12]),ge=e!==n[13]?n[13]:ge,Oe=e!==n[14]?n[14]:Oe}function l(){function e(e,t){return"function"==typeof e&&(r("Setup custom "+t+"CalcMethod"),ke[t]=e,e="custom"),e}"iFrameResizer"in window&&Object===window.iFrameResizer.constructor&&(!function(){var e=window.iFrameResizer;r("Reading data from page: "+JSON.stringify(e)),Ie="messageCallback"in e?e.messageCallback:Ie,Ne="readyCallback"in e?e.readyCallback:Ne,ve="targetOrigin"in e?e.targetOrigin:ve,oe="heightCalculationMethod"in e?e.heightCalculationMethod:oe,Oe="widthCalculationMethod"in e?e.widthCalculationMethod:Oe}(),oe=e(oe,"height"),Oe=e(Oe,"width")),r("TargetOrigin for parent set to: "+ve)}function s(e,t){return-1!==t.indexOf("-")&&(a("Negative CSS value ignored for "+e),t=""),t}function d(t,n){e!==n&&""!==n&&"null"!==n&&(document.body.style[t]=n,r("Body "+t+' set to "'+n+'"'))}function f(){e===Y&&(Y=X+"px"),d("margin",s("margin",Y))}function m(){document.documentElement.style.height="",document.body.style.height="",r('HTML & body height set to "auto"')}function g(e){var i={add:function(n){function o(){W(e.eventName,e.eventType)}Ae[n]=o,t(window,n,o)},remove:function(e){var t=Ae[e];delete Ae[e],n(window,e,t)}};e.eventNames&&Array.prototype.map?(e.eventName=e.eventNames[0],e.eventNames.map(i[e.method])):i[e.method](e.eventName),r(o(e.method)+" event listener: "+e.eventType)}function h(e){g({method:e,eventType:"Animation Start",eventNames:["animationstart","webkitAnimationStart"]}),g({method:e,eventType:"Animation Iteration",eventNames:["animationiteration","webkitAnimationIteration"]}),g({method:e,eventType:"Animation End",eventNames:["animationend","webkitAnimationEnd"]}),g({method:e,eventType:"Input",eventName:"input"}),g({method:e,eventType:"Mouse Up",eventName:"mouseup"}),g({method:e,eventType:"Mouse Down",eventName:"mousedown"}),g({method:e,eventType:"Orientation Change",eventName:"orientationchange"}),g({method:e,eventType:"Print",eventName:["afterprint","beforeprint"]}),g({method:e,eventType:"Ready State Change",eventName:"readystatechange"}),g({method:e,eventType:"Touch Start",eventName:"touchstart"}),g({method:e,eventType:"Touch End",eventName:"touchend"}),g({method:e,eventType:"Touch Cancel",eventName:"touchcancel"}),g({method:e,eventType:"Transition Start",eventNames:["transitionstart","webkitTransitionStart","MSTransitionStart","oTransitionStart","otransitionstart"]}),g({method:e,eventType:"Transition Iteration",eventNames:["transitioniteration","webkitTransitionIteration","MSTransitionIteration","oTransitionIteration","otransitioniteration"]}),g({method:e,eventType:"Transition End",eventNames:["transitionend","webkitTransitionEnd","MSTransitionEnd","oTransitionEnd","otransitionend"]}),"child"===ge&&g({method:e,eventType:"IFrame Resized",eventName:"resize"})}function p(e,t,n,o){return t!==e&&(e in n||(a(e+" is not a valid option for "+o+"CalculationMethod."),e=t),r(o+' calculation method set to "'+e+'"')),e}function v(){oe=p(oe,ne,ze,"height")}function y(){Oe=p(Oe,Se,Re,"width")}function b(){!0===U?(h("add"),A()):r("Auto Resize disabled")}function w(){r("Disable outgoing messages"),he=!1}function T(){r("Remove event listener: Message"),n(window,"message",J)}function E(){null!==$&&$.disconnect()}function S(){h("remove"),E(),clearInterval(ce)}function O(){w(),T(),!0===U&&S()}function M(){var e=document.createElement("div");e.style.clear="both",e.style.display="block",document.body.appendChild(e)}function I(){function n(){return{x:window.pageXOffset!==e?window.pageXOffset:document.documentElement.scrollLeft,y:window.pageYOffset!==e?window.pageYOffset:document.documentElement.scrollTop}}function o(e){var t=e.getBoundingClientRect(),o=n();return{x:parseInt(t.left,10)+parseInt(o.x,10),y:parseInt(t.top,10)+parseInt(o.y,10)}}function i(t){var n=t.split("#")[1]||t,i=decodeURIComponent(n),a=document.getElementById(i)||document.getElementsByName(i)[0];e!==a?function(e){var t=o(e);r("Moving to in page link (#"+n+") at x: "+t.x+" y: "+t.y),V(t.y,t.x,"scrollToOffset")}(a):(r("In page link (#"+n+") not found in iFrame, so sending to parent"),V(0,0,"inPageLink","#"+n))}function u(){""!==location.hash&&"#"!==location.hash&&i(location.href)}function c(){function e(e){function n(e){e.preventDefault(),i(this.getAttribute("href"))}"#"!==e.getAttribute("href")&&t(e,"click",n)}Array.prototype.forEach.call(document.querySelectorAll('a[href^="#"]'),e)}function l(){t(window,"hashchange",u)}function s(){setTimeout(u,_)}return ae.enable?function(){Array.prototype.forEach&&document.querySelectorAll?(r("Setting up location.hash handlers"),c(),l(),s()):a("In page linking not fully supported in this browser! (See README.md for IE8 workaround)")}():r("In page linking not enabled"),{findTarget:i}}function N(){r("Enable public methods"),Me.parentIFrame={autoResize:function(e){return!0===e&&!1===U?(U=!0,b()):!1===e&&!0===U&&(U=!1,S()),U},close:function(){V(0,0,"close"),O()},getId:function(){return fe},getPageInfo:function(e){"function"==typeof e?(Ce=e,V(0,0,"pageInfo")):(Ce=function(){},V(0,0,"pageInfoStop"))},moveToAnchor:function(e){ae.findTarget(e)},reset:function(){B("parentIFrame.reset")},scrollTo:function(e,t){V(t,e,"scrollTo")},scrollToOffset:function(e,t){V(t,e,"scrollToOffset")},sendMessage:function(e,t){V(0,0,"message",JSON.stringify(e),t)},setHeightCalculationMethod:function(e){oe=e,v()},setWidthCalculationMethod:function(e){Oe=e,y()},setTargetOrigin:function(e){r("Set targetOrigin: "+e),ve=e},size:function(e,t){W("size","parentIFrame.size("+(e||"")+(t?","+t:"")+")",e,t)}}}function C(){0!==ue&&(r("setInterval: "+ue+"ms"),ce=setInterval(function(){W("interval","setInterval: "+ue)},Math.abs(ue)))}function k(){function t(e){function t(e){!1===e.complete&&(r("Attach listeners to "+e.src),e.addEventListener("load",a,!1),e.addEventListener("error",u,!1),l.push(e))}"attributes"===e.type&&"src"===e.attributeName?t(e.target):"childList"===e.type&&Array.prototype.forEach.call(e.target.querySelectorAll("img"),t)}function n(e){l.splice(l.indexOf(e),1)}function o(e){r("Remove listeners from "+e.src),e.removeEventListener("load",a,!1),e.removeEventListener("error",u,!1),n(e)}function i(t,n,i){o(t.target),W(n,i+": "+t.target.src,e,e)}function a(e){i(e,"imageLoad","Image loaded")}function u(e){i(e,"imageLoadFailed","Image load failed")}function c(e){W("mutationObserver","mutationObserver: "+e[0].target+" "+e[0].type),e.forEach(t)}var l=[],s=window.MutationObserver||window.WebKitMutationObserver,d=function(){var e=document.querySelector("body"),t={attributes:!0,attributeOldValue:!1,characterData:!0,characterDataOldValue:!1,childList:!0,subtree:!0};return d=new s(c),r("Create body MutationObserver"),d.observe(e,t),d}();return{disconnect:function(){"disconnect"in d&&(r("Disconnect body MutationObserver"),d.disconnect(),l.forEach(o))}}}function A(){var e=0>ue;window.MutationObserver||window.WebKitMutationObserver?e?C():$=k():(r("MutationObserver not supported in this browser!"),C())}function x(e,t){var n=0;return t=t||document.body,"defaultView"in document&&"getComputedStyle"in document.defaultView?(n=document.defaultView.getComputedStyle(t,null),n=null!==n?n[e]:0):n=function(e){if(/^\d+(px)?$/i.test(e))return parseInt(e,j);var n=t.style.left,o=t.runtimeStyle.left;return t.runtimeStyle.left=t.currentStyle.left,t.style.left=e||0,e=t.style.pixelLeft,t.style.left=n,t.runtimeStyle.left=o,e}(t.currentStyle[e]),parseInt(n,j)}function z(e){e>Te/2&&(Te=2*e,r("Event throttle increased to "+Te+"ms"))}function R(e,t){for(var n=t.length,i=0,a=0,u=o(e),c=xe(),l=0;l<n;l++)(i=t[l].getBoundingClientRect()[e]+x("margin"+u,t[l]))>a&&(a=i);return c=xe()-c,r("Parsed "+n+" HTML elements"),r("Element position calculated in "+c+"ms"),z(c),a}function L(e){return[e.bodyOffset(),e.bodyScroll(),e.documentElementOffset(),e.documentElementScroll()]}function F(e,t){var n=document.querySelectorAll("["+t+"]");return 0===n.length&&function(){a("No tagged elements ("+t+") found on page"),document.querySelectorAll("body *")}(),R(e,n)}function P(){return document.querySelectorAll("body *")}function D(t,n,o,i){function a(){return!(t in{init:1,interval:1,size:1})}function u(){return oe in me||Q&&Oe in me}function c(){r("No change in size detected")}var l,s;!function(){function t(e,t){return!(Math.abs(e-t)<=ye)}return l=e!==o?o:ze[oe](),s=e!==i?i:Re[Oe](),t(te,l)||Q&&t(Ee,s)}()&&"init"!==t?function(){a()&&u()?B(n):t in{interval:1}||c()}():(q(),function(){te=l,Ee=s,V(te,Ee,t)}())}function W(e,t,n,o){!function(){return be&&e in Z}()?(!function(){e in{reset:1,resetPage:1,init:1}||r("Trigger event: "+t)}(),Le(e,t,n,o)):r("Trigger event cancelled: "+e)}function q(){be||(be=!0,r("Trigger event lock on")),clearTimeout(we),we=setTimeout(function(){be=!1,r("Trigger event lock off"),r("--")},_)}function H(e){te=ze[oe](),Ee=Re[Oe](),V(te,Ee,e)}function B(e){var t=oe;oe=ne,r("Reset trigger event: "+e),q(),H("reset"),oe=t}function V(t,n,o,i,a){!0===he&&(function(){e===a?a=ve:r("Message targetOrigin: "+a)}(),function(){var u=t+":"+n,c=fe+":"+u+":"+o+(e!==i?":"+i:"");r("Sending message to host page ("+c+")"),pe.postMessage(se+c,a)}())}function J(e){function n(){return e.data.split("]")[1].split(":")[0]}function o(){return e.data.substr(e.data.indexOf(":")+1)}function i(){return!("undefined"!=typeof module&&module.exports)&&"iFrameResize"in window}function c(){return e.data.split(":")[2]in{true:1,false:1}}function l(){var t=n();t in s?s[t]():i()||c()||a("Unexpected message ("+e.data+")")}var s={init:function(){document.body?function(){re=e.data,pe=e.source,u(),ee=!1,setTimeout(function(){ie=!1},_)}():(r("Waiting for page ready"),t(window,"readystatechange",s.initFromParent))},reset:function(){ie?r("Page reset ignored by init"):(r("Page size reset by host page"),H("resetPage"))},resize:function(){W("resizeParent","Parent window requested size check")},moveToAnchor:function(){ae.findTarget(o())},inPageLink:function(){this.moveToAnchor()},pageInfo:function(){var e=o();r("PageInfoFromParent called from parent: "+e),Ce(JSON.parse(e)),r(" --")},message:function(){var e=o();r("MessageCallback called from parent: "+e),Ie(JSON.parse(e)),r(" --")}};(function(){return se===(""+e.data).substr(0,de)})()&&function(){!1===ee?l():c()?s.init():r('Ignored message of type "'+n()+'". Received before initialization.')}()}if("undefined"!=typeof window){var U=!0,j=10,K="",X=0,Y="",$=null,G="",Q=!1,Z={resize:1,click:1},_=128,ee=!0,te=1,ne="bodyOffset",oe=ne,ie=!0,re="",ae={},ue=32,ce=null,le=!1,se="[iFrameSizer]",de=se.length,fe="",me={max:1,min:1,bodyScroll:1,documentElementScroll:1},ge="child",he=!0,pe=window.parent,ve="*",ye=0,be=!1,we=null,Te=16,Ee=1,Se="scroll",Oe=Se,Me=window,Ie=function(){a("MessageCallback function not defined")},Ne=function(){},Ce=function(){},ke={height:function(){return a("Custom height calculation function not defined"),document.documentElement.offsetHeight},width:function(){return a("Custom width calculation function not defined"),document.body.scrollWidth}},Ae={},xe=Date.now||function(){return(new Date).getTime()},ze={bodyOffset:function(){return document.body.offsetHeight+x("marginTop")+x("marginBottom")},offset:function(){return ze.bodyOffset()},bodyScroll:function(){return document.body.scrollHeight},custom:function(){return ke.height()},documentElementOffset:function(){return document.documentElement.offsetHeight},documentElementScroll:function(){return document.documentElement.scrollHeight},max:function(){return Math.max.apply(null,L(ze))},min:function(){return Math.min.apply(null,L(ze))},grow:function(){return ze.max()},lowestElement:function(){return Math.max(ze.bodyOffset(),R("bottom",P()))},taggedElement:function(){return F("bottom","data-iframe-height")}},Re={bodyScroll:function(){return document.body.scrollWidth},bodyOffset:function(){return document.body.offsetWidth},custom:function(){return ke.width()},documentElementScroll:function(){return document.documentElement.scrollWidth},documentElementOffset:function(){return document.documentElement.offsetWidth},scroll:function(){return Math.max(Re.bodyScroll(),Re.documentElementScroll())},max:function(){return Math.max.apply(null,L(Re))},min:function(){return Math.min.apply(null,L(Re))},rightMostElement:function(){return R("right",P())},taggedElement:function(){return F("right","data-iframe-width")}},Le=function(e){var t,n,o,i=null,r=0,a=function(){r=xe(),i=null,o=e.apply(t,n),i||(t=n=null)};return function(){var u=xe();r||(r=u);var c=Te-(u-r);return t=this,n=arguments,c<=0||c>Te?(i&&(clearTimeout(i),i=null),r=u,o=e.apply(t,n),i||(t=n=null)):i||(i=setTimeout(a,c)),o}}(D);t(window,"message",J),function(){"loading"!==document.readyState&&window.parent.postMessage("[iFrameResizerChild]Ready","*")}()}}();
},{}],5:[function(require,module,exports){
"use strict";module.exports=require("./src/client");

},{"./src/client":6}],6:[function(require,module,exports){
"use strict";function Client(e){if(!(this instanceof Client))return new Client(e);e=e||{},Port.call(this,window.parent,"*",e),e.syncLang&&this.use(syncLang),!1!==e.syncTitle&&this.use(syncTitle),e.syncFont&&this.use(syncFont),!1!==e.resizeFrame&&this.use(resizer)}var inherits=require("inherits"),Promise=require("lie"),Port=require("./port"),resizer=require("./plugins/iframe-resizer/client"),syncLang=require("./plugins/sync-lang/client"),syncTitle=require("./plugins/sync-title/client"),syncFont=require("./plugins/sync-font/client");inherits(Client,Port),Client.prototype.connect=function(){var e=this;return new Promise(function(n){e.open(),e._sendMessage("evt","ready"),Port.prototype.connect.call(e),n(e)})},module.exports=Client;
},{"./plugins/iframe-resizer/client":7,"./plugins/sync-font/client":8,"./plugins/sync-lang/client":9,"./plugins/sync-title/client":10,"./port":12,"inherits":18,"lie":19}],7:[function(require,module,exports){
"use strict";module.exports=function(e){window.iframeResizer={targetOrigin:e._targetOrigin},require("iframe-resizer/js/iframeResizer.contentWindow")};

},{"iframe-resizer/js/iframeResizer.contentWindow":4}],8:[function(require,module,exports){
"use strict";module.exports=function(e){return e.request("font").then(function(e){var s=e.size;if(!e.visualRedesign)switch(e.size){case"11px":s="18px";break;case"17px":s="22px";break;case"26px":s="24px";break;default:s="20px"}document.documentElement.style.fontSize=s,e.dyslexic&&document.body.classList.add("vui-dyslexic")})};

},{}],9:[function(require,module,exports){
"use strict";module.exports=function(t){return t.request("lang").then(function(t){var e=document.getElementsByTagName("html")[0];e.setAttribute("lang",t.lang),t.fallback&&e.setAttribute("data-lang-default",t.fallback),t.isRtl&&(document.body.dir="rtl")})};

},{}],10:[function(require,module,exports){
"use strict";function installClientPolling(t){var e="";setInterval(function(){var n=document.title;n!==e&&(e=n,t(e))},100)}function installClientMutation(t){var e=document.querySelector("title");null===e&&(e=document.createElement("title"),document.getElementsByTagName("head")[0].appendChild(e)),t(document.title),new window.MutationObserver(function(e){t(e[0].target.textContent)}).observe(e,{subtree:!0,characterData:!0,childList:!0})}module.exports=function(t){function e(e){t.sendEvent("title",e)}"MutationObserver"in window?installClientMutation(e):installClientPolling(e)};
},{}],11:[function(require,module,exports){
"use strict";function Port(e,t,n){if(!(this instanceof Port))return new Port(e,t,n);n=n||{},this._connectQueue=[],this._debugEnabled=n.debug||!1,this._endpoint=e,this._eventHandlers={},this._isConnected=!1,this._isOpen=!1,this._messageHandlers={},this._onCloseCallbacks=[],this._targetOrigin=t,this._id=uuid();var s=this;this._onMessage("evt",function(){s._receiveEvent.apply(s,arguments)})}var uuid=require("uuid"),validateEvent=require("./validate-event");Port.prototype.close=function(){if(!this._isOpen)throw new Error("Port cannot be closed, call open() first");this._isOpen=!1,this._isConnected=!1,window.removeEventListener("message",this._receiveMessage),this._onCloseCallbacks.forEach(function(e){e()}),this.debug("closed")},Port.prototype.connect=function(){return this._isConnected=!0,this.debug("connected"),this._connectQueue.forEach(function(e){e()}),this._connectQueue=[],this},Port.prototype.debug=function(e){this._debugEnabled&&console.log(e)},Port.prototype._initHashArrAndPush=function(e,t,n){void 0===e[t]&&(e[t]=[]),e[t].push(n)},Port.prototype.onClose=function(e){this._onCloseCallbacks.push(e)},Port.prototype.onEvent=function(e,t){return this.debug('onEvent handler added for "'+e+'"'),this._isConnected&&this.debug("You've attached event handlers after connecting, you may have missed some events"),this._initHashArrAndPush(this._eventHandlers,e,t),this},Port.prototype.open=function(){if(this._isOpen)throw new Error("Port is already open.");return this._isOpen=!0,window.addEventListener("message",this._receiveMessage.bind(this),!1),this.debug("opened"),this},Port.prototype._receiveMessage=function(e){if(validateEvent(this._targetOrigin,this._endpoint,e)){var t=e.data.key.substr(5,3),n=e.data.key.substr(9);this.debug("received "+t+"."+n);var s=this._messageHandlers[t];s&&s.call(this,n,e.data.payload)}},Port.prototype._onMessage=function(e,t){if(3!==e.length)throw new Error("message class name must be 3 characters");this._messageHandlers[e]=t},Port.prototype._receiveEvent=function(e,t){void 0!==this._eventHandlers[e]&&this._eventHandlers[e].forEach(function(e){e.apply(e,t)})},Port.prototype._sendMessage=function(e,t,n){var s={key:"frau."+e+"."+t,payload:n};return this.debug("sending key: "+s.key),this._endpoint.postMessage(s,this._targetOrigin),this},Port.prototype.sendEvent=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);if(!this._isConnected){var s=this;return this._connectQueue.push(function(){s._sendMessage("evt",e,t)}),this}return this._sendMessage("evt",e,t)},Port.prototype.use=function(e){return e(this),this},module.exports=Port;

},{"./validate-event":16,"uuid":21}],12:[function(require,module,exports){
"use strict";module.exports=require("./services");

},{"./services":14}],13:[function(require,module,exports){
"use strict";function PortWithRequests(){if(!(this instanceof PortWithRequests))return new PortWithRequests.apply(this,arguments);Port.apply(this,arguments),this._pendingRequests={},this._requestHandlers={},this._requestCounter=0,this._waitingRequests=[];var e=this;this._onMessage("req",function(){e._receiveRequest.apply(e,arguments)}),this._onMessage("res",function(){e._receiveRequestResponse.apply(e,arguments)})}var inherits=require("inherits"),Promise=require("lie"),Port=require("./base"),fromError=require("./transform-error").fromError,toError=require("./transform-error").toError;inherits(PortWithRequests,Port),PortWithRequests.prototype.request=function(e){for(var t=new Array(arguments.length-1),r=1;r<arguments.length;++r)t[r-1]=arguments[r];var s=this;return new Promise(function(r,i){function n(){s._sendMessage("req",e,{id:u,args:t})}var o=++s._requestCounter,u=s._id+"_"+o;s._initHashArrAndPush(s._pendingRequests,e,{id:u,resolve:r,reject:i}),s._isConnected?n():s._connectQueue.push(n)})},PortWithRequests.prototype.onRequest=function(e,t){if(this._isConnected)throw new Error("Add request handlers before connecting");if(void 0!==this._requestHandlers[e])throw new Error('Duplicate onRequest handler for type "'+e+'"');return this.debug('onRequest handler added for "'+e+'"'),this._requestHandlers[e]=t,this._sendRequestResponse(e),this},PortWithRequests.prototype._receiveRequest=function(e,t){this._initHashArrAndPush(this._waitingRequests,e,t),this._sendRequestResponse(e)},PortWithRequests.prototype._sendRequestResponse=function(e){var t=this._requestHandlers[e],r=this._waitingRequests[e];if(delete this._waitingRequests[e],void 0!==t&&void 0!==r&&0!==r.length){var s=this;r.forEach(function(r){Promise.resolve().then(function(){return"function"==typeof t?t.apply(t,r.args):t}).then(function(t){s._sendMessage("res",e,{id:r.id,val:t})}).catch(function(t){var i=fromError(t);s._sendMessage("res",e,{id:r.id,err:i})})})}},PortWithRequests.prototype._receiveRequestResponse=function(e,t){var r=this._pendingRequests[e];if(void 0!==r)for(var s=0;s<r.length;++s){var i=r[s];if(i.id===t.id){if(t.hasOwnProperty("err")){var n=toError(t.err);i.reject(n)}else i.resolve(t.val);return void r.splice(s,1)}}},module.exports=PortWithRequests;
},{"./base":11,"./transform-error":15,"inherits":18,"lie":19}],14:[function(require,module,exports){
"use strict";function PortWithServices(){if(!(this instanceof PortWithServices))return new PortWithServices.apply(this,arguments);PortWithRequests.apply(this,arguments)}var inherits=require("inherits"),PortWithRequests=require("./requests"),typeNameValidator=/^[a-zA-Z]+[a-zA-Z\-]*$/;inherits(PortWithServices,PortWithRequests),PortWithServices.prototype.getService=function(e,t){function r(e){function t(e){return function(){var t=new Array(arguments.length+1);t[0]=i+":"+e;for(var r=0;r<arguments.length;++r)t[r+1]=arguments[r];return n.request.apply(n,t)}}var r={};return e.forEach(function(e){r[e]=t(e)}),r}if(!this._isConnected)throw new Error("Cannot getService() before connect() has completed");var i="service:"+e+":"+t,n=this;return n.request(i).then(r)},PortWithServices.prototype.registerService=function(e,t,r){if(this._isConnected)throw new Error("Register services before connecting");if(!typeNameValidator.test(e))throw new Error('Invalid service type "'+e+'"');var i="service:"+e+":"+t,n=Object.keys(r).filter(function(e){return"function"==typeof r[e]});this.onRequest(i,n);var o=this;return n.forEach(function(e){o.onRequest(i+":"+e,r[e])}),this},module.exports=PortWithServices;

},{"./requests":13,"inherits":18}],15:[function(require,module,exports){
"use strict";function deErrorifyArray(r){return r.map(deErrorify)}function errorifyArray(r){return r.map(errorify)}function deErrorifyObject(r){var e=r instanceof Error,o=e?{props:{}}:{};e&&(o.message=r.message,o.name=r.name,o[ERROR_OBJECT_SENTINEL]=!0);var n=e?o.props:o;return Object.keys(r).forEach(function(e){var o=deErrorify(r[e]);n[e]=o}),o}function errorifyObject(r){var e=!0===r[ERROR_OBJECT_SENTINEL],o=e?new Error(r.message):{};e&&(o.name=r.name);var n=e?r.props:r;return Object.keys(n).forEach(function(r){var e=errorify(n[r]);o[r]=e}),o}function deErrorify(r){return null!==r&&"object"==typeof r?Array.isArray(r)?deErrorifyArray(r):deErrorifyObject(r):"function"==typeof r?null:r}function errorify(r){return null!==r&&"object"==typeof r?Array.isArray(r)?errorifyArray(r):errorifyObject(r):r}var ERROR_OBJECT_SENTINEL="_ifrau-error-object";module.exports.ERROR_OBJECT_SENTINEL=ERROR_OBJECT_SENTINEL,module.exports.fromError=deErrorify,module.exports.toError=errorify;
},{}],16:[function(require,module,exports){
"use strict";function isStringEmpty(t){return!t||0===t.length}function validateEvent(t,e,i){return i.source===e&&("*"===t||!isStringEmpty(t)&&!isStringEmpty(i.origin)&&t.toUpperCase()===i.origin.toUpperCase())&&void 0!==i.data.key&&null!==i.data.key&&0===i.data.key.indexOf("frau.")}module.exports=validateEvent;
},{}],17:[function(require,module,exports){
(function (global){
"use strict";function nextTick(){draining=!0;for(var e,n,a=queue.length;a;){for(n=queue,queue=[],e=-1;++e<a;)n[e]();a=queue.length}draining=!1}function immediate(e){1!==queue.push(e)||draining||scheduleDrain()}var Mutation=global.MutationObserver||global.WebKitMutationObserver,scheduleDrain;if(Mutation){var called=0,observer=new Mutation(nextTick),element=global.document.createTextNode("");observer.observe(element,{characterData:!0}),scheduleDrain=function(){element.data=called=++called%2}}else if(global.setImmediate||void 0===global.MessageChannel)scheduleDrain="document"in global&&"onreadystatechange"in global.document.createElement("script")?function(){var e=global.document.createElement("script");e.onreadystatechange=function(){nextTick(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},global.document.documentElement.appendChild(e)}:function(){setTimeout(nextTick,0)};else{var channel=new global.MessageChannel;channel.port1.onmessage=nextTick,scheduleDrain=function(){channel.port2.postMessage(0)}}var draining,queue=[];module.exports=immediate;

}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],18:[function(require,module,exports){
"function"==typeof Object.create?module.exports=function(t,e){t.super_=e,t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(t,e){t.super_=e;var o=function(){};o.prototype=e.prototype,t.prototype=new o,t.prototype.constructor=t};
},{}],19:[function(require,module,exports){
"use strict";function INTERNAL(){}function Promise(e){if("function"!=typeof e)throw new TypeError("resolver must be a function");this.state=PENDING,this.queue=[],this.outcome=void 0,e!==INTERNAL&&safelyResolveThenable(this,e)}function QueueItem(e,t,r){this.promise=e,"function"==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),"function"==typeof r&&(this.onRejected=r,this.callRejected=this.otherCallRejected)}function unwrap(e,t,r){immediate(function(){var n;try{n=t(r)}catch(t){return handlers.reject(e,t)}n===e?handlers.reject(e,new TypeError("Cannot resolve promise with itself")):handlers.resolve(e,n)})}function getThen(e){var t=e&&e.then;if(e&&("object"==typeof e||"function"==typeof e)&&"function"==typeof t)return function(){t.apply(e,arguments)}}function safelyResolveThenable(e,t){function r(t){i||(i=!0,handlers.reject(e,t))}function n(t){i||(i=!0,handlers.resolve(e,t))}function o(){t(n,r)}var i=!1,s=tryCatch(o);"error"===s.status&&r(s.value)}function tryCatch(e,t){var r={};try{r.value=e(t),r.status="success"}catch(e){r.status="error",r.value=e}return r}function resolve(e){return e instanceof this?e:handlers.resolve(new this(INTERNAL),e)}function reject(e){var t=new this(INTERNAL);return handlers.reject(t,e)}function all(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var o=new Array(r),i=0,s=-1,u=new this(INTERNAL);++s<r;)!function(e,s){function l(e){o[s]=e,++i!==r||n||(n=!0,handlers.resolve(u,o))}t.resolve(e).then(l,function(e){n||(n=!0,handlers.reject(u,e))})}(e[s],s);return u}function race(e){var t=this;if("[object Array]"!==Object.prototype.toString.call(e))return this.reject(new TypeError("must be an array"));var r=e.length,n=!1;if(!r)return this.resolve([]);for(var o=-1,i=new this(INTERNAL);++o<r;)!function(e){t.resolve(e).then(function(e){n||(n=!0,handlers.resolve(i,e))},function(e){n||(n=!0,handlers.reject(i,e))})}(e[o]);return i}var immediate=require("immediate"),handlers={},REJECTED=["REJECTED"],FULFILLED=["FULFILLED"],PENDING=["PENDING"];module.exports=Promise,Promise.prototype.catch=function(e){return this.then(null,e)},Promise.prototype.then=function(e,t){if("function"!=typeof e&&this.state===FULFILLED||"function"!=typeof t&&this.state===REJECTED)return this;var r=new this.constructor(INTERNAL);if(this.state!==PENDING){unwrap(r,this.state===FULFILLED?e:t,this.outcome)}else this.queue.push(new QueueItem(r,e,t));return r},QueueItem.prototype.callFulfilled=function(e){handlers.resolve(this.promise,e)},QueueItem.prototype.otherCallFulfilled=function(e){unwrap(this.promise,this.onFulfilled,e)},QueueItem.prototype.callRejected=function(e){handlers.reject(this.promise,e)},QueueItem.prototype.otherCallRejected=function(e){unwrap(this.promise,this.onRejected,e)},handlers.resolve=function(e,t){var r=tryCatch(getThen,t);if("error"===r.status)return handlers.reject(e,r.value);var n=r.value;if(n)safelyResolveThenable(e,n);else{e.state=FULFILLED,e.outcome=t;for(var o=-1,i=e.queue.length;++o<i;)e.queue[o].callFulfilled(t)}return e},handlers.reject=function(e,t){e.state=REJECTED,e.outcome=t;for(var r=-1,n=e.queue.length;++r<n;)e.queue[r].callRejected(t);return e},Promise.resolve=resolve,Promise.reject=reject,Promise.all=all,Promise.race=race;
},{"immediate":17}],20:[function(require,module,exports){
(function (global){
var rng,crypto=global.crypto||global.msCrypto;if(crypto&&crypto.getRandomValues){var _rnds8=new Uint8Array(16);rng=function(){return crypto.getRandomValues(_rnds8),_rnds8}}if(!rng){var _rnds=new Array(16);rng=function(){for(var r,n=0;n<16;n++)0==(3&n)&&(r=4294967296*Math.random()),_rnds[n]=r>>>((3&n)<<3)&255;return _rnds}}module.exports=rng;
}).call(this,typeof global !== "undefined" ? global : typeof self !== "undefined" ? self : typeof window !== "undefined" ? window : {})
},{}],21:[function(require,module,exports){
function parse(e,s,r){var t=s&&r||0,n=0;for(s=s||[],e.toLowerCase().replace(/[0-9a-f]{2}/g,function(e){n<16&&(s[t+n++]=_hexToByte[e])});n<16;)s[t+n++]=0;return s}function unparse(e,s){var r=s||0,t=_byteToHex;return t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]+"-"+t[e[r++]]+t[e[r++]]+"-"+t[e[r++]]+t[e[r++]]+"-"+t[e[r++]]+t[e[r++]]+"-"+t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]+t[e[r++]]}function v1(e,s,r){var t=s&&r||0,n=s||[];e=e||{};var o=void 0!==e.clockseq?e.clockseq:_clockseq,a=void 0!==e.msecs?e.msecs:(new Date).getTime(),u=void 0!==e.nsecs?e.nsecs:_lastNSecs+1,c=a-_lastMSecs+(u-_lastNSecs)/1e4;if(c<0&&void 0===e.clockseq&&(o=o+1&16383),(c<0||a>_lastMSecs)&&void 0===e.nsecs&&(u=0),u>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");_lastMSecs=a,_lastNSecs=u,_clockseq=o,a+=122192928e5;var i=(1e4*(268435455&a)+u)%4294967296;n[t++]=i>>>24&255,n[t++]=i>>>16&255,n[t++]=i>>>8&255,n[t++]=255&i;var _=a/4294967296*1e4&268435455;n[t++]=_>>>8&255,n[t++]=255&_,n[t++]=_>>>24&15|16,n[t++]=_>>>16&255,n[t++]=o>>>8|128,n[t++]=255&o;for(var d=e.node||_nodeId,v=0;v<6;v++)n[t+v]=d[v];return s||unparse(n)}function v4(e,s,r){var t=s&&r||0;"string"==typeof e&&(s="binary"==e?new Array(16):null,e=null),e=e||{};var n=e.random||(e.rng||_rng)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,s)for(var o=0;o<16;o++)s[t+o]=n[o];return s||unparse(n)}for(var _rng=require("./rng"),_byteToHex=[],_hexToByte={},i=0;i<256;i++)_byteToHex[i]=(i+256).toString(16).substr(1),_hexToByte[_byteToHex[i]]=i;var _seedBytes=_rng(),_nodeId=[1|_seedBytes[0],_seedBytes[1],_seedBytes[2],_seedBytes[3],_seedBytes[4],_seedBytes[5]],_clockseq=16383&(_seedBytes[6]<<8|_seedBytes[7]),_lastMSecs=0,_lastNSecs=0,uuid=v4;uuid.v1=v1,uuid.v4=v4,uuid.parse=parse,uuid.unparse=unparse,module.exports=uuid;
},{"./rng":20}]},{},[1]);
